<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--Pagina inicial una vez que la Tienda se ha logueado-->
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <ui:composition template="./WEB-INF/templates/template.xhtml">
        <ui:define name="content">
            <!--Espacio del menu-->
            <div style="height: 5.2rem"></div>
            <!--FIN espacio-->
            <ui:param name="tiendaG" value="#{session.getValue('usuarioLogeado')}"/>
            <!--Zona de Gestion-->
            <div class="container-fluid m-0 p-0 mt-5" >
                <div class="row col-12 m-0 p-2 d-flex justify-content-around ">
                    <!--Zona que muestra los ultimos Pedidos solicitados a la Tienda-->
                    <div class="col-5 pr-3 tienda_datos">
                        <h4 class="mt-3">
                            <h:outputText value="#{msgs['tienda.subGestion_pedidos']}"/>
                        </h4>
                        <div class="row d-flex justify-content-around mt-3 p-2 tienda_datos--altura ">
                            <h:panelGroup rendered="#{controlador.subPedidos(tiendaG.id_usuario).size() gt 0}">
                                <p:dataTable value="#{controlador.subPedidos(tiendaG.id_usuario)}" var="sp" styleClass="tabla col-12 my-3" rows="8" >
                                    <p:column>
                                        <f:facet name="header" >ID pedido</f:facet>
                                        <h:outputText value="#{sp.pedido.id_pedido}"/>
                                    </p:column>
                                    <p:column>
                                        <f:facet name="header">Id: producto</f:facet>
                                        <h:outputText value="#{sp.producto.id_producto}"/>
                                    </p:column>
                                    <p:column>
                                        <f:facet name="header">Nombre</f:facet>
                                        <h:outputText value="#{sp.producto.nombre} "/>
                                    </p:column>
                                    <p:column>
                                        <f:facet name="header">Cantidad</f:facet>
                                        <h:outputText value="#{sp.cantidad_producto} "/>
                                    </p:column>
                                    <p:column>
                                        <f:facet name="header">Fecha</f:facet>
                                        <h:outputText value="#{sp.pedido.fecha_pedido.date} / #{sp.pedido.fecha_pedido.month} / #{1900 + sp.pedido.fecha_pedido.year} ">
                                            <f:convertDateTime dateStyle="short"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column>
                                        <f:facet name="header">Estado</f:facet>
                                        <h:outputText value="#{sp.estado} "/>
                                    </p:column>
                                </p:dataTable>
                            </h:panelGroup>
                            <h:panelGroup rendered="#{controlador.subPedidos(tiendaG.id_usuario).size() eq 0}">
                                <div class="row my-5 mensaje-vacio">
                                    <h3 class="centrar--texto mensaje-vacio__texto">
                                        <h:outputText value="#{msgs['pedido.vacio_mensaje']}" />
                                    </h3>
                                    <h:graphicImage url="resources/images/sin_pedidos.png" styleClass="mensaje-vacio__imagen"/>
                                </div>
                            </h:panelGroup>
                            <h:link outcome="tiendaGestionPedidos" value="#{msgs['tienda.ver_pedidos']}" styleClass="col-12 enlace--boton centrar--texto mt-4 align-self-end"/>
                        </div>
                    </div>
                    <!--FIN Pedidos solicitados-->
                    <!--Zona que muestra los últimos Productos introducidos-->
                    <div class="col-5 pl-3 tienda_datos">
                        <h4 class="mt-3">
                            <h:outputText value="#{msgs['tienda.subGestion_productos']}"/>
                        </h4>
                        <div class="row d-flex justify-content-around mt-3 p-2 tienda_datos--altura ">
                            <h:panelGroup rendered="#{controlador.ultimosProductos(tiendaG.id_usuario).size() gt 0 }">
                                <h:form styleClass="col-12" class="ultimosProductos">
                                    <p:dataGrid var="p" value="#{controlador.ultimosProductos(tiendaG.id_usuario)}" columns="3" layout="grid" rows="3" paginator="false" styleClass="">
                                        <p:panel styleClass="tablas-datos centrar--texto p-0" >
                                            <h:panelGrid columns="1" styleClass="col-12 p-3 ultimosProductos_borde">
                                                <h:commandLink action="producto_tInicio" >
                                                    <f:setPropertyActionListener target="#{producto.id_producto}" value="#{p.id_producto}"/>
                                                    <p:graphicImage url="resources/images/#{p.nombreFoto}" styleClass="tablas-datos__imagen"/>
                                                </h:commandLink>
                                                <h:outputText value="#{p.nombre}" />
                                                <h:panelGroup>
                                                    <h:outputText value="#{p.precio*(1+(p.tipoIVA/100))}">
                                                        <f:convertNumber type="currency" currencySymbol="€" maxIntegerDigits="5" maxFractionDigits="2" locale="es-ES"/>
                                                    </h:outputText>
                                                    <h:outputText value="/#{p.unidad}"/>
                                                </h:panelGroup>
                                                <h:commandLink action="producto_tInicio" value="#{msgs['cliente.tablas_producto']}" styleClass="tablas-datos__enlaces">
                                                    <!--Establecemos en valor a la propiedad del ManageBean Producto para poder usarlo en la siguiente página-->
                                                    <f:setPropertyActionListener target="#{producto.id_producto}" value="#{p.id_producto}"/>
                                                </h:commandLink>
                                            </h:panelGrid>
                                        </p:panel>
                                    </p:dataGrid>
                                </h:form>
                            </h:panelGroup>
                            <h:panelGroup rendered="#{controlador.ultimosProductos(tiendaG.id_usuario).size() eq 0 }">
                                <div class="row my-5 mensaje-vacio" style="border: 1px solid red">
                                    <h3 class="centrar--texto mensaje-vacio__texto">
                                        <h:outputText value="#{msgs['producto.vacio_mensaje']}" />
                                    </h3>
                                    <h:graphicImage url="resources/images/sin_pedidos.png" styleClass="mensaje-vacio__imagen"/>
                                </div>
                            </h:panelGroup>
                            <h:link outcome="tiendaProductos" value="#{msgs['tienda.ver_productos']}" styleClass="col-12 enlace--boton centrar--texto mt-4 align-self-end"/>
                        </div>
                    </div>
                    <!--Fin Últimos Pedidos-->
                </div>
                <!--FIN Zona Gestion-->
                <!--Zona Análisis-->
                <div class="row col-12 m-0 p-2 d-flex justify-content-center " >
                    <div class="col-11 pr-3 tienda_datos">
                        <h4 class="mt-3">
                            <h:outputText value="#{msgs['tienda.subGestion_analisis']}"/>
                        </h4>
                    </div>
                </div>
                <!--FIN zona Análisis-->
            </div>

        </ui:define>
    </ui:composition>

</html>

